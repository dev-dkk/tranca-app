{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/santo/OneDrive/%C3%81rea%20de%20Trabalho/Afrobraids%20Software/Aplica%C3%A7%C3%A3o/sistema-trancas/frontend/app/my-appointments/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\n\r\nexport default function MyAppointments() {\r\n  const router = useRouter();\r\n  const [appointments, setAppointments] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const userStored = localStorage.getItem('user');\r\n    if (!userStored) {\r\n        router.push('/login');\r\n        return;\r\n    }\r\n    const user = JSON.parse(userStored);\r\n\r\n    fetch(`http://localhost:3001/appointments/my/${user.id}`)\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (Array.isArray(data)) setAppointments(data);\r\n        })\r\n        .finally(() => setLoading(false));\r\n  }, [router]);\r\nasync function handleCancel(appointmentId: string) {\r\n    if (!confirm(\"Tem certeza que deseja cancelar este agendamento?\")) return;\r\n\r\n    const user = JSON.parse(localStorage.getItem('user') || '{}');\r\n\r\n    try {\r\n        const res = await fetch(`http://localhost:3001/appointments/${appointmentId}/cancel`, {\r\n            method: 'PATCH', // Usamos PATCH para atualiza√ß√£o parcial\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ userId: user.id, role: user.role })\r\n        });\r\n\r\n        if (res.ok) {\r\n            alert(\"Agendamento cancelado.\");\r\n            // Recarrega a lista removendo ou atualizando o item\r\n            setAppointments((prev) => \r\n                prev.map(app => app.id === appointmentId ? { ...app, status: 'CANCELED' } : app)\r\n            );\r\n        } else {\r\n            const data = await res.json();\r\n            alert(data.error || \"Erro ao cancelar.\");\r\n        }\r\n    } catch (error) {\r\n        alert(\"Erro de conex√£o.\");\r\n    }\r\n  }\r\n  if (loading) return <div className=\"p-8 text-center text-beleza-500\">Carregando seus hor√°rios...</div>;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-beleza-50 p-6\">\r\n        <div className=\"max-w-4xl mx-auto\">\r\n            <div className=\"flex justify-between items-center mb-8\">\r\n                <h1 className=\"text-2xl font-bold text-beleza-900\">üíá‚Äç‚ôÄÔ∏è Meus Agendamentos</h1>\r\n                <button onClick={() => router.push('/')} className=\"text-sm underline text-beleza-600\">Voltar</button>\r\n            </div>\r\n\r\n            {appointments.length === 0 ? (\r\n                <div className=\"text-center py-10 bg-white rounded-xl shadow\">\r\n                    <p className=\"text-gray-500 mb-4\">Voc√™ ainda n√£o tem agendamentos.</p>\r\n                    <button onClick={() => router.push('/')} className=\"bg-beleza-500 text-white px-6 py-2 rounded-lg\">Agendar Agora</button>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid gap-4\">\r\n                    {appointments.map((app) => (\r\n                        <div key={app.id} className=\"bg-white p-6 rounded-xl shadow-md border-l-4 border-beleza-500 flex flex-col md:flex-row justify-between items-center\">\r\n                            <div>\r\n                                <h2 className=\"text-xl font-bold text-beleza-800\">{app.services?.name}</h2>\r\n                                <p className=\"text-gray-500 text-sm\">\r\n                                    {format(new Date(app.start_time), \"dd 'de' MMMM '√†s' HH:mm\", { locale: ptBR })}\r\n                                </p>\r\n                            </div>\r\n                            <div className=\"mt-4 md:mt-0 text-right\">\r\n                                <span className={`px-3 py-1 rounded-full text-xs font-bold ${\r\n                                    app.status === 'CONFIRMED' ? 'bg-green-100 text-green-700' : \r\n                                    app.status === 'CANCELED' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'\r\n                                }`}>\r\n                                    {app.status === 'CONFIRMED' ? 'Confirmado' : app.status}\r\n                                </span>\r\n                                <p className=\"text-lg font-bold text-beleza-600 mt-2\">R$ {Number(app.services?.price).toFixed(2)}</p>\r\n                                {/* BOT√ÉO DE CANCELAR (S√≥ aparece se n√£o estiver cancelado) */}\r\n                                {app.status !== 'CANCELED' && (\r\n                                    <button \r\n                                        onClick={() => handleCancel(app.id)}\r\n                                        className=\"text-xs text-red-500 hover:text-red-700 underline font-medium mt-1\"\r\n                                    >\r\n                                        Cancelar Agendamento\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}